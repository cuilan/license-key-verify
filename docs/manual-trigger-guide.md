# 手动触发工作流指南

本文档详细说明如何手动触发 GitHub Actions 工作流。

## 🎯 访问 GitHub Actions

1. 打开你的项目页面：https://github.com/cuilan/license-key-verify
2. 点击顶部的 **Actions** 标签页
3. 你将看到所有可用的工作流

## 🔧 手动触发 CI 工作流

### 步骤说明

1. **选择工作流**
   - 在左侧工作流列表中点击 **"CI"**

2. **启动手动触发**
   - 点击右上角的 **"Run workflow"** 按钮
   - 会出现一个下拉菜单

3. **配置参数**
   - **Branch**: 选择要运行的分支（通常是 `main`）
   - **是否运行测试**: 
     - ✅ 选中 = 运行完整测试套件
     - ❌ 取消 = 跳过测试
   - **是否构建所有平台**:
     - ✅ 选中 = 构建所有平台（Windows, macOS, Linux）
     - ❌ 取消 = 跳过构建

4. **执行工作流**
   - 点击绿色的 **"Run workflow"** 按钮
   - 工作流将开始执行

### 使用场景

- **快速测试**: 只运行测试，不构建 → 取消"构建所有平台"
- **完整构建**: 测试 + 构建 → 两个选项都选中
- **仅构建**: 跳过测试，只构建 → 取消"运行测试"

## 🐳 手动触发 Docker 工作流

### 步骤说明

1. **选择工作流**
   - 在左侧工作流列表中点击 **"Docker"**

2. **启动手动触发**
   - 点击右上角的 **"Run workflow"** 按钮

3. **配置参数**
   - **Branch**: 选择要运行的分支
   - **是否推送到容器注册表**:
     - ✅ 选中 = 构建并推送镜像到 GitHub Container Registry
     - ❌ 取消 = 只构建镜像，不推送（用于测试）
   - **构建平台**: 
     - 默认: `linux/amd64,linux/arm64`
     - 可选: `linux/amd64` (仅 x64)
     - 可选: `linux/arm64` (仅 ARM64)

4. **执行工作流**
   - 点击绿色的 **"Run workflow"** 按钮

### 使用场景

- **测试构建**: 不推送到注册表 → 取消"推送到容器注册表"
- **发布镜像**: 构建并推送 → 选中"推送到容器注册表"
- **特定平台**: 只构建某个架构 → 修改"构建平台"参数

## 🚀 自动触发的工作流

### Release 工作流

**触发条件**: 推送版本标签（如 `v1.0.0`）

```bash
# 创建并推送标签
git tag v1.0.0
git push origin v1.0.0
```

**自动执行**:
- 运行测试
- 构建所有平台
- 创建 GitHub Release
- 构建并推送 Docker 镜像

## 📊 监控工作流状态

### 实时监控

1. **工作流列表**: 查看所有工作流的运行历史
2. **详细日志**: 点击具体的工作流运行查看详细日志
3. **状态指示**:
   - 🟡 **黄色**: 正在运行
   - 🟢 **绿色**: 成功完成
   - 🔴 **红色**: 执行失败
   - ⚪ **灰色**: 已取消

### 通知设置

- GitHub 会自动发送邮件通知工作流状态
- 可以在 GitHub 设置中配置通知偏好

## 🛠️ 故障排除

### 常见问题

1. **"Run workflow" 按钮不可见**
   - 确保你有仓库的写权限
   - 确保工作流文件语法正确

2. **工作流执行失败**
   - 查看详细日志找出错误原因
   - 检查代码是否有语法错误
   - 确认测试是否通过

3. **Docker 推送失败**
   - 检查是否有 `packages: write` 权限
   - 确认 GitHub Token 有效

### 调试技巧

1. **查看详细日志**
   ```
   Actions → 选择工作流 → 点击运行记录 → 展开步骤
   ```

2. **本地测试**
   ```bash
   # 测试构建
   make build-all
   
   # 测试 Docker
   docker build -t test .
   ```

3. **重新运行**
   - 可以在工作流详情页面点击 "Re-run jobs" 重新运行

## 💡 最佳实践

1. **开发阶段**: 使用手动触发，避免频繁的自动构建
2. **测试阶段**: 先不推送 Docker 镜像，只测试构建
3. **发布阶段**: 使用标签触发自动发布流程
4. **紧急修复**: 可以手动触发快速构建和部署

## 📝 工作流配置

如需修改工作流参数的默认值，编辑对应的 `.github/workflows/*.yml` 文件：

```yaml
# 修改默认参数
inputs:
  run_tests:
    description: '是否运行测试'
    required: false
    default: false  # 改为 false
    type: boolean
```

提交修改后，下次手动触发时将使用新的默认值。 